<!DOCTYPE html>
<html>
<head>
<title>天气查询</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" type="text/css" href="../plugin/bootstrap/3.0.3/css/bootstrap.min.css" />
</head>
<body>
	<script type="text/javascript" src="../plugin/jquery/1.11.2/jquery.min.js"></script>
	<div id="navbar" class="navbar navbar-default" role="navigation">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse"
				data-target=".navbar-collapse">
				<span class="icon-bar"></span> <span class="icon-bar"></span> <span
					class="icon-bar"></span>
			</button>
			<a class="navbar-brand"
				href="https://github.com/spring-projects/spring-boot"> Spring Boot
			</a>
		</div>
		<div class="navbar-collapse collapse">
			<ul class="nav navbar-nav">
				<li><a href="./"> Home </a></li>
			</ul>
		</div>
	</div>
	<div class="jumbotron">
		<h1>Home</h1>
		<p>Some static content</p>
		<p>
          <a class="btn btn-lg btn-primary" href="#navbar" role="button">Go &raquo;</a>
        </p>
        <button class="btn btn_primary" id="checkJsApi">checkJsApi</button>
        <span class="desc">获取“分享给朋友”按钮点击状态及自定义分享内容接口</span>
      <button class="btn btn_primary" id="onMenuShareAppMessage">onMenuShareAppMessage</button>
	</div>
	<script type="text/javascript" src="../plugin/jquery/1.11.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script>
    	var respTimestamp;
    	var respNonceStr;
    	var respSignature;
    	
    	$(function() {
			$.ajax({
				type : "GET",
				url : "http://qiqi.localtunnel.me/wechat/jsSignature?url=http://qiqi.localtunnel.me/views/weather.html",
				success : function(msg) {
					respSignature = msg.timestamp;
					respNonceStr = msg.nonceStr;
					respSignature = msg.signature;
					console.log(JSON.stringify(msg));
				},
				error : function() {
					alert("error");
				}
			});
		});
    	
        /*
    	 * 注意：
    	 * 1. 所有的JS接口只能在公众号绑定的域名下调用，公众号开发者需要先登录微信公众平台进入“公众号设置”的“功能设置”里填写“JS接口安全域名”。
    	 * 2. 如果发现在 Android 不能分享自定义内容，请到官网下载最新的包覆盖安装，Android 自定义分享接口需升级至 6.0.2.58 版本及以上。
    	 * 3. 常见问题及完整 JS-SDK 文档地址：http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html
    	 *
    	 * 开发中遇到问题详见文档“附录5-常见错误及解决办法”解决，如仍未能解决可通过以下渠道反馈：
    	 * 邮箱地址：weixin-open@qq.com
    	 * 邮件主题：【微信JS-SDK反馈】具体问题
    	 * 邮件内容说明：用简明的语言描述问题所在，并交代清楚遇到该问题的场景，可附上截屏图片，微信团队会尽快处理你的反馈。
    	 */
    	wx.config({
    		debug : true,
    		appId : 'wxe6626fc25736c77e',
    		timestamp : respTimestamp,
    		nonceStr : respNonceStr,
    		signature : respSignature,
    		jsApiList : [ 'checkJsApi',
    				'onMenuShareTimeline',
    				'onMenuShareAppMessage',
    				'onMenuShareQQ',
    				'onMenuShareWeibo',
    				'onMenuShareQZone',
    				'hideMenuItems', 'showMenuItems',
    				'hideAllNonBaseMenuItem',
    				'showAllNonBaseMenuItem',
    				'translateVoice', 'startRecord',
    				'stopRecord', 'onVoiceRecordEnd',
    				'playVoice', 'onVoicePlayEnd',
    				'pauseVoice', 'stopVoice',
    				'uploadVoice', 'downloadVoice',
    				'chooseImage', 'previewImage',
    				'uploadImage', 'downloadImage',
    				'getNetworkType', 'openLocation',
    				'getLocation', 'hideOptionMenu',
    				'showOptionMenu', 'closeWindow',
    				'scanQRCode', 'chooseWXPay',
    				'openProductSpecificView',
    				'addCard', 'chooseCard', 'openCard' ]
    	});

		 wx.ready(function () {
			  // 1 判断当前版本是否支持指定 JS 接口，支持批量判断
			  document.querySelector('#checkJsApi').onclick = function () {
			    wx.checkJsApi({
			      jsApiList: [
			        'getNetworkType',
			        'previewImage'
			      ],
			      success: function (res) {
			        alert(JSON.stringify(res));
			      }
			    });
			  };
			  
			  // 2.1 监听“分享给朋友”，按钮点击、自定义分享内容及分享结果接口
			  document.querySelector('#onMenuShareAppMessage').onclick = function () {
			    wx.onMenuShareAppMessage({
			      title: '互联网之子',
			      desc: '在长大的过程中，我才慢慢发现，我身边的所有事，别人跟我说的所有事，那些所谓本来如此，注定如此的事，它们其实没有非得如此，事情是可以改变的。更重要的是，有些事既然错了，那就该做出改变。',
			      link: 'http://movie.douban.com/subject/25785114/',
			      imgUrl: 'http://demo.open.weixin.qq.com/jssdk/images/p2166127561.jpg',
			      trigger: function (res) {
			        // 不要尝试在trigger中使用ajax异步请求修改本次分享的内容，因为客户端分享操作是一个同步操作，这时候使用ajax的回包会还没有返回
			        alert('用户点击发送给朋友');
			      },
			      success: function (res) {
			        alert('已分享');
			      },
			      cancel: function (res) {
			        alert('已取消');
			      },
			      fail: function (res) {
			        alert(JSON.stringify(res));
			      }
			    });
			    alert('已注册获取“发送给朋友”状态事件');
			  };
		}); 
		</script>
    
</body>
</html>
